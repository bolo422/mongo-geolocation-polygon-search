<!DOCTYPE html>
<html>
<head>
    <title>OpenStreetMap Coordinate Selector</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 100vh;
            width: 100%;
        }
        #submit-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
        }
        #submit-btn:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
<button id="submit-btn">Send Coordinates</button>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    let map;
    let markers = [];
    let polyline;

    // Inicializa o mapa
    function initMap() {
        map = L.map('map').setView([0, 0], 2); // Centraliza o mapa

        // Carrega o mapa do OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Adiciona evento de clique no mapa para adicionar marcadores
        map.on('click', (event) => {
            addMarker(event.latlng);
        });

        polyline = L.polyline([], { color: 'red' }).addTo(map); // Linha para conectar os pontos
        document.getElementById('submit-btn').addEventListener('click', sendCoordinates);
    }

    // Adiciona marcador e atualiza a linha
    function addMarker(location) {
        const marker = L.marker(location).addTo(map);
        markers.push(marker);
        updatePolyline();
    }

    // Atualiza a linha conectando os marcadores
    function updatePolyline() {
        const latlngs = markers.map(marker => marker.getLatLng());
        polyline.setLatLngs(latlngs);
    }

    // Envia as coordenadas para o backend
    function sendCoordinates() {
        const coordinates = markers.map(marker => ({
            lat: marker.getLatLng().lat,
            lng: marker.getLatLng().lng
        }));

        // Envia as coordenadas para o backend via fetch
        fetch('/saveCoordinates', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(coordinates)
        })
            .then(response => {
                if (response.ok) {
                    alert('Coordinates sent successfully!');
                } else {
                    alert('Failed to send coordinates.');
                }
            })
            .catch(error => console.error('Error:', error));
    }

    // Inicializa o mapa quando a p√°gina carrega
    window.onload = initMap;
</script>
</body>
</html>
